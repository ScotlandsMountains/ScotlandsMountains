<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Upload</title>

    <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase-firestore.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>

        $(document).ready(function() {

            firebase.initializeApp({
                apiKey: "AIzaSyA8yKN6tlZ94Tjo9te2Jzt6tx7kuD8RpAY",
                authDomain: "scotmnt.firebaseapp.com",
                projectId: "scotmnt"
            });
            var db = firebase.firestore();

            var root = null;

            $.ajax({
                url: "output.json",
                success: function(json) {
                    root = json;
                    $("#do-not-press").prop("disabled", false);
                }
            });

            var saveEntityCollection = function(name) {

                var count = 0;
                var batch = null;

                for (var property in root[name]) {

                    if (batch === null) {
                        batch = db.batch();
                    }

                    if (root[name].hasOwnProperty(property)) {
                        batch.set(db.collection(name).doc(property.toString()), root[name][property]);
                        count++;
                    }

                    if (count === 500) {
                        var commitingCount = count;
                        var commitingBatch = batch;
                        commitingBatch
                            .commit()
                            .then(function () { console.log("Committed " + commitingCount + " " + name); })
                            .catch(function(error) { console.error("Error committing batch: ", error); });

                        count = 0;
                        batch = null;
                    }
                }

                if (count > 0) {
                    var commitingCount = count;
                    var commitingBatch = batch;
                    commitingBatch
                        .commit()
                        .then(function () { console.log("Committed " + commitingCount + " " + name); })
                        .catch(function(error) { console.error("Error committing batch: ", error); });
                }

                //for (var property in root[name]) {
                //    if (root[name].hasOwnProperty(property)) {
                //        db.collection(name)
                //            .doc(property.toString())
                //            .set(root[name][property])
                //            .then(function(docRef) { console.log("Document written with ID: ", property); })
                //            .catch(function(error) { console.error("Error adding document: ", error); });
                //    }
                //    break;
                //}
            };

            $("#do-not-press").on("click",
                function() {
                    //saveEntityCollection("mountains");
                    //saveEntityCollection("sections");
                    //saveEntityCollection("classifications");
                    //saveEntityCollection("countries");
                    saveEntityCollection("maps");
                });
        })

    </script>

</head>
<body>
    
    <button id="do-not-press" disabled="disabled">Start</button>

</body>
</html>